import os.path
from easygui import *
import sys
import httplib2



if os.path.isfile('user.cfg'):
	config = open('user.cfg', 'r')
	LOGIN = config.readline().rstrip()
	PASSWORD = config.readline().rstrip()
	config.close()

else:	
	#get data from user
	msg = "Enter user information"
	title = "BeaconizeMe"
	fieldNames = ["Login", "Password"]
	fieldValues = []  # we start with blanks for the values
	fieldValues = multpasswordbox(msg, title, fieldNames)

	# make sure that none of the fields was left blank
	while 1:
		if fieldValues == None: 
			sys.exit(0)
		errmsg = ""
   		for i in range(len(fieldNames)):
			if fieldValues[i].strip() == "":
				errmsg = errmsg + ('"%s" is a required field.' % fieldNames[i])
		if errmsg == "": break # no problems found
		msgbox("You must enter both login and password.")
		fieldValues = multpasswordbox(msg, title, fieldNames, fieldValues)


#LOGIN = fieldValues[0]
#PASSWORD = fieldValues[1]
LOGIN="test"
PASSWORD="test123"
#save data to file
config = open('user.cfg','w')
config.write(LOGIN+'\n');
config.write(PASSWORD+'\n');
config.close()

#connect to get MAC
resp, data= httplib2.Http().request("http://fpostepski.beep.pl/beacon/get.php?login="+LOGIN+"&pass="+PASSWORD)
tabhexmac=[]
start = 0
while 1:
	start = data.find('beacon_mac', start+1)
	if start == -1:
		break
	end = data.find("\"",start+13)
	hexmac = data[start+13:end]
	tabhexmac += hexmac
	

#wywolanie scan.js z parametrem MAC

mac=""
a=0
for x in tabhexmac:
	mac = mac + x
	if a%2 == 1 and a < 11:
		mac = mac + ":"
	if a==11:
		a=-1
		mac = mac + "\n"
	a += 1
mac = mac[:-1]
#print mac
#echo mac > MAC
	





